<!DOCTYPE html>
<html>
<head>
    <title>Dashboard with Visualizations</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="flex flex-col min-h-screen m-0 font-sans">
    <header class="bg-gray-800 text-white text-center p-4 flex justify-between items-center">
        <a href="index.html">
            <img src="images/logo.png" alt="Logo" class="h-12"> <!-- Adjust the path and class as needed -->
        </a>
        <button id="toggleSidebar" class="px-4 py-2 text-white">â˜°</button>
    </header>
    <div id="dashboard" class="flex flex-1 relative">
        <aside id="sidebar" class="bg-gray-100 p-4 w-64 absolute inset-y-0 right-0 transform translate-x-full transition-transform duration-300 ease-in-out z-10">
            <nav>
                <ul>
                    <li><a href="subgroups.html" class="text-blue-600 hover:text-blue-700">Subgroups</a></li>
                    <li><a href="index.html" class="text-blue-600 hover:text-blue-700">Sepsis Risk</a></li>
                    <li><a href="about.html" class="text-blue-600 hover:text-blue-700">About</a></li>
                    <li><a href="report.html" class="text-blue-600 hover:text-blue-700">Report</a></li>
                    <!-- More links for other visualizations -->
                </ul>
            </nav>
        </aside>
        <section id="main-content" class="flex-1 p-4 flex flex-col justify-center items-center">
            <div class="grid grid-cols-2 w-full h-full gap-4">
                <!-- Left side -->
                <div class="grid grid-cols-2 grid-rows-3 gap-4">
                    <div class="bg-white p-4 border border-gray-300 rounded-lg">
                        <h2 class="text-lg font-semibold mb-4 text-center">Patient Information</h2>
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div id="subject_id_display"></div> <!-- Subject ID -->
                            <div id="subject_name_display"></div> <!-- Subject Name -->
                            <div><strong>Age:</strong> None</div>
                            <div><strong>Gender:</strong> None</div>
                        </div>
                        <h2 id="jit_time" class="text-md font-semibold mb-2 text-center">Just In Time Information</h2>
                        <div class="grid grid-cols-2 gap-4">
                            <div id="hr_display"></div>
                            <div id="temp_display"></div>
                            <div id="rr_display"></div>
                            <div id="bp_display"></div>
                        </div>
                    </div>
                    <div class="bg-white p-4 border border-gray-300 rounded-lg">
                        <h2 class="text-lg font-semibold mb-4 text-center">Elixhauser Comorbidity Categories</h2>
                        <ul class="list-disc pl-5">
                            <li class="mb-2"></li>
                        </ul>
                    </div>
                    <div class="bg-white p-4 border border-gray-300 rounded-lg col-span-2 row-span-2">
                        <select id="visualSelector">
                            <option value="visual1">Visual 1 - Circle</option>
                            <option value="visual2">Visual 2 - Rectangle</option>
                            <!-- Add more options for additional visuals -->
                        </select>
                        <div id="d3VisualContainer"></div> <!-- Container for Visuals -->
                    </div>
                </div>
                
                <!-- Right side -->
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-white p-4 border border-gray-300 rounded-lg">
                        <h2 class="text-lg font-semibold mb-4 text-center">Patient Group Analysis</h2>
                        <div class="text-center p-4 my-4 bg-blue-100 rounded-lg">
                            <h3 class="text-xl font-bold">Subgroup 1</h3>
                            <p class="text-green-600">Likelihood: <span class="font-bold">83%</span></p>
                        </div>
                        <p class="text-sm text-gray-600 italic">Our automated analysis is 83% confident this patient belongs in the Cardiopulmonary subgroup. This is taken into account for our sepsis risk analysis.</p>

                        <!-- Disease selection dropdown -->
                        <div class="text-center mb-4">
                            <label for="disease-select" class="block mb-2 text-sm font-medium text-gray-900">Select a Disease:</label>
                            <select id="disease-select" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                                <option value="">--Please choose an option--</option>
                                <option value="congestive_heart_failure">Congestive Heart Failure</option>
                                <option value="cardiac_arrhythmias">Cardiac Arrhythmias</option>
                                <option value="valvular_disease">Valvular Disease</option>
                                <option value="pulmonary_circulation">Pulmonary Circulation Disorders</option>
                                <option value="peripheral_vascular">Peripheral Vascular Disease</option>
                                <option value="hypertension">Hypertension</option>
                                <option value="paralysis">Paralysis</option>
                                <option value="other_neurological">Other Neurological Disorders</option>
                                <option value="chronic_pulmonary">Chronic Pulmonary Disease</option>
                                <option value="diabetes_uncomplicated">Diabetes Uncomplicated</option>
                                <option value="diabetes_complicated">Diabetes Complicated</option>
                                <option value="hypothyroidism">Hypothyroidism</option>
                                <option value="renal_failure">Renal Failure</option>
                                <option value="liver_disease">Liver Disease</option>
                                <option value="peptic_ulcer">Peptic Ulcer Disease</option>
                                <option value="aids">AIDS/HIV</option>
                                <option value="lymphoma">Lymphoma</option>
                                <option value="metastatic_cancer">Metastatic Cancer</option>
                                <option value="solid_tumor">Solid Tumor without Metastasis</option>
                                <option value="rheumatoid_arthritis">Rheumatoid Arthritis</option>
                                <option value="coagulopathy">Coagulopathy</option>
                                <option value="obesity">Obesity</option>
                                <option value="weight_loss">Weight Loss</option>
                                <option value="fluid_electrolyte">Fluid and Electrolyte Disorders</option>
                                <option value="blood_loss_anemia">Blood Loss Anemia</option>
                                <option value="deficiency_anemias">Deficiency Anemias</option>
                                <option value="alcohol_abuse">Alcohol Abuse</option>
                                <option value="drug_abuse">Drug Abuse</option>
                                <option value="psychoses">Psychoses</option>
                                <option value="depression">Depression</option>
                            </select>
                        </div>
                        <!-- Disease Description Display -->
                        <div id="disease-description" class="mt-4 p-4 bg-blue-100 border border-blue-500 rounded-lg text-blue-700">
                            Select a disease to see its description.
                        </div>
                        <!-- JavaScript file for R function (02_logistic_regression.R) -->
                        <script src="scripts/sub1_comorbidity_logistic.js"></script> <!-- Link to your JavaScript file -->
                    </div>
                    <div class="bg-white p-4 border border-gray-300 rounded-lg">
                        <h2 class="text-lg font-semibold mb-4 text-center">Sepsis Risk Alert</h2>
                        <div id="risk_banner">
                        </div>
                        <p class="text-sm text-gray-600 italic">Next steps: [INSERT NEXT STEPS HERE]</p>
                    </div>
                </div>
            </div>
        </section>
        
    </div>
    <footer class="bg-gray-800 text-white text-center p-4">
        DSC 180B
    </footer>
    <script>
        document.getElementById('toggleSidebar').addEventListener('click', function() {
            var sidebar = document.getElementById('sidebar');
            // Toggle between translate-x-full and translate-x-0 to show/hide the sidebar
            sidebar.classList.toggle('translate-x-full');
            sidebar.classList.toggle('translate-x-0');
        });

        // Function to update the text in the right half
        function updateText(subgroupName) {
            const infoContainer = document.getElementById('subgroup-info');
            infoContainer.textContent = `You clicked on ${subgroupName}`;
        }

        // Function to update the header in the right half
        function updateTitle(subgroupName) {
            const infoContainer = document.getElementById('subgroup-name');
            infoContainer.textContent = `${subgroupName}:`
        }
        // Function to parse URL parameters
        function getQueryParam(param) {
            var queryString = window.location.search.substring(1); // Get query string, excluding '?'
            var queryParams = queryString.split('&'); // Split into key-value pairs
            for (var i = 0; i < queryParams.length; i++) {
                var pair = queryParams[i].split('='); // Split key-value pair
                if (decodeURIComponent(pair[0]) == param) { // Check if the current key matches the parameter we want
                    return decodeURIComponent(pair[1]); // Return the value
                }
            }
            return null; // If the parameter isn't found, return null
        }

        // Extract userId from URL parameters
        var userId = getQueryParam('subject_id');

        // Extract color from URL parameters
        var riskColor = getQueryParam('risk_color');

        // Select the p tag by its id and set its content to the userId
        if (userId) {
            document.getElementById('subject_id_display').innerHTML = `<strong>ID:</strong> ${userId}`;
        } else {
            document.getElementById('subject_id_display').innerHTML = `<strong>ID:</strong> 0000`;
        }

        // Set the background color of the body based on the risk color
        if (riskColor === 'green') {
            document.getElementById('risk_banner').innerHTML = `<div id="risk_banner" class="text-center p-4 my-4 bg-green-100 border-l-4 border-green-500 rounded-lg">
                            <h3 class="text-xl font-bold text-green-600">Green Flag - Low Risk</h3>
                            <p class="mb-4">This patient has been identified as at low risk for developing sepsis.</p>
                        </div>`;
        }
        else if (riskColor === 'yellow') {
            document.getElementById('risk_banner').innerHTML = `<div id="risk_banner" class="text-center p-4 my-4 bg-yellow-100 border-l-4 border-yellow-500 rounded-lg">
                            <h3 class="text-xl font-bold text-yellow-600">Yellow Flag - Medium Risk</h3>
                            <p class="mb-4">This patient has been identified as at Medium risk for developing sepsis.</p>
                        </div>`;
        }
        else if (riskColor === 'red') {
            document.getElementById('risk_banner').innerHTML = `<div id="risk_banner" class="text-center p-4 my-4 bg-red-100 border-l-4 border-red-500 rounded-lg">
                            <h3 class="text-xl font-bold text-red-600">Red Flag - Severe Risk</h3>
                            <p class="mb-4">This patient has been identified as at severe risk for developing sepsis.</p>
                        </div>`;
        }
        else {
            document.getElementById('risk_banner').innerHTML = `<div id="risk_banner" class="text-center p-4 my-4 bg-blue-100 border-l-4 border-blue-500 rounded-lg">
                            <h3 class="text-xl font-bold text-blue-600">No Flag Yet</h3>
                            <p class="mb-4">This patient has yet to be identified at a risk level. Please come back soon.</p>
                        </div>`;
        }
        function fetchAndDisplayData(fileName) {
            fetch(`processed_data/id${fileName}.json`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    document.getElementById('subject_name_display').innerHTML = `<strong>Name:</strong> ${data.name}`;
                    document.getElementById('jit_time').innerHTML = `Just In Time: ${data.latest_chart_time}`;
                    document.getElementById('hr_display').innerHTML = `<strong>Heart Rate:</strong> ${data.latest_heart_rate} bpm`;
                    document.getElementById('temp_display').innerHTML = `<strong>Temperature:</strong> ${data.latest_temp_F} F`;
                    document.getElementById('rr_display').innerHTML = `<strong>Respiratory Rate:</strong> ${data.latest_respiratory_rate} bpm`;
                    document.getElementById('bp_display').innerHTML = `<strong>Blood Pressure:</strong> ${data.latest_blood_pressure} mm Hg`;
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                });
        }


        // Fetch and display the data if the parameter is provided
        if (userId) {
            fetchAndDisplayData(userId);
        } else {
            console.log('No data file specified.');
        }

        // Function to draw Visual 1
        function drawVisual1() {
            const svg = d3.select('#d3VisualContainer').append('svg')
                .attr('width', 200)
                .attr('height', 200);

            svg.append('circle')
                .attr('cx', 100)
                .attr('cy', 100)
                .attr('r', 50)
                .attr('fill', 'red');
        }

        // Function to draw Visual 2
        function drawVisual2() {
            const svg = d3.select('#d3VisualContainer').append('svg')
                .attr('width', 200)
                .attr('height', 200);

            svg.append('rect')
                .attr('x', 50)
                .attr('y', 50)
                .attr('width', 100)
                .attr('height', 100)
                .attr('fill', 'blue');
        }

        // Function to update the visual based on the dropdown selection
        function updateVisual(selectedVisual) {
            // Clear the previous visual
            d3.select('#d3VisualContainer').selectAll('*').remove();

            // Draw the selected visual
            if (selectedVisual === 'visual1') {
                drawVisual1();
            } else if (selectedVisual === 'visual2') {
                drawVisual2();
            }
            // Add more conditions for additional visuals
        }

        // Event listener for the dropdown
        document.getElementById('visualSelector').addEventListener('change', function() {
            updateVisual(this.value);
        });

        // Initial visual setup
        updateVisual('visual1'); // Default to showing the first visual

    </script>
</body>
</html>